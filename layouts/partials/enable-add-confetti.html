<!--
  enable-confetti.html - Hugo Partial for Confetti Effects

  This partial adds interactive confetti effects to elements on your webpage.
  Include this partial in your Hugo layouts to enable the functionality.

  Classes Supported:
  ------------------
  1. .click-add-confetti
     - Add this class to any clickable element (e.g., buttons, links) to trigger
       the confetti effect when clicked.
     - Example:
       <button class="click-add-confetti">Click Me for Confetti</button>

  2. .in-view-confetti
     - Add this class to elements that should trigger the confetti effect when
       they scroll into the viewport.
     - Confetti will only trigger once per element.
     - Example:
       <div class="in-view-confetti" style="height: 100vh;">Scroll into view!</div>

  Notes:
  ------
  - The color sets for confetti effects are pre-defined and rotate sequentially.
  - Make sure to include the JSConfetti library in your project for this partial to work:
    https://github.com/loonywizard/js-confetti
-->

<script>
  // Ensure JSConfetti is instantiated only once
  if (!window.jsConfettiInstance) {
    window.jsConfettiInstance = new JSConfetti();
  }

  // Color sets for confetti
  const colorSets = [
    ['#ff0a54', '#ff477e', '#ff7096', '#ff85a1', '#fbb1bd', '#f9bec7'], // Sakura
    ['#0077b6', '#00b4d8', '#90e0ef', '#caf0f8', '#ade8f4'], // Ocean Breeze
    ['#ff4500', '#ff7f50', '#ffae42', '#ffd700', '#ffe4b5'], // Sunset Glow
    ['#264653', '#2a9d8f', '#e9c46a', '#f4a261', '#e76f51'], // Forest Whisper
    ['#ff00e4', '#ff80ed', '#ffb3b3', '#ffbdbd', '#ffe4e1'], // Candy Pop
    ['#3c096c', '#9d4edd', '#c77dff', '#e0aaff', '#ffc6ff'], // Galaxy Magic
  ];

  // Track the current color set
  let currentSetIndex = 0;

  // Function to add confetti
  function add_confetti() {
    const colorSet = colorSets[currentSetIndex];
    window.jsConfettiInstance.addConfetti({
      confettiColors: colorSet,
    });

    // Cycle to the next color set
    currentSetIndex = (currentSetIndex + 1) % colorSets.length;
  }

  // Throttle function: limits how often a function can execute
  function throttle(func, delay) {
    let lastCall = 0;
    return (...args) => {
      const now = new Date().getTime();
      if (now - lastCall >= delay) {
        lastCall = now;
        return func(...args);
      }
    };
  }

  // Add event listener to elements with the class `.click-add-confetti`
  document.addEventListener('DOMContentLoaded', () => {
    const throttledAddConfetti = throttle(add_confetti, 1200); // Limit clicks to once every 2 seconds
    document.querySelectorAll('.click-add-confetti').forEach((element) => {
      element.addEventListener('click', () => {
        throttledAddConfetti();
      });
      element.addEventListener('dragstart', (event) => {
          event.preventDefault();
      });
    });

      // Observer for elements with the `in-view-confetti` class
    const inViewObserver = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          add_confetti(); // Trigger confetti when the element is in view
          inViewObserver.unobserve(entry.target); // Stop observing after the first trigger
        }
      });
    });

    // Observe all elements with the class `in-view-confetti`
    document.querySelectorAll('.in-view-confetti').forEach((element) => {
      inViewObserver.observe(element);
    });
  });
</script>
